<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Day-Trading Simulator</title>

<style>
body { font-family: Arial; background:#eef2f7; padding:20px; }
h1 { text-align:center; }

.dashboard {
  display:flex; justify-content:space-around;
  padding:15px; background:white;
  border-radius:10px; margin-bottom:20px;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
}
.metric { font-size:1.1em; font-weight:bold; }

.stock-container {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:15px;
}
.stock-card {
  background:white; padding:15px; border-radius:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.15);
}
canvas { width:100%; height:120px; }

.controls button {
  padding:6px 10px; margin:3px;
  border:none; border-radius:6px;
  cursor:pointer; color:white;
}
.buy { background:#4caf50; }
.sell { background:#f44336; }
.short { background:#3333cc; }
.cover { background:#cc33aa; }
.hold { background:#777; }

#tradeTable {
  background:white; margin-top:25px; width:100%; border-radius:10px;
  box-shadow:0 2px 6px rgba(0,0,0,0.15);
  border-collapse:collapse;
}
#tradeTable th, #tradeTable td {
  padding:10px; border-bottom:1px solid #ddd; text-align:center;
}
#tradeTable th { background:#3f51b5; color:white; }
.green { color:#4caf50; font-weight:bold; }
.red { color:#f44336; font-weight:bold; }
</style>
</head>

<body>

<h1>ðŸ“Š Advanced Day-Trading Simulator</h1>

<div class="dashboard">
  <div class="metric">ðŸ’° Funds: â‚¹<span id="funds">10000</span></div>
  <div class="metric">ðŸ“¦ Net Holdings: â‚¹<span id="holdings">0</span></div>
  <div class="metric">ðŸ’¹ Net Value: â‚¹<span id="netValue">10000</span></div>
  <div class="metric">ðŸ“Š P/L: <span id="pl">0</span></div>
</div>

<div class="stock-container" id="stocks"></div>

<h2>ðŸ“˜ Trade Dashboard</h2>
<table id="tradeTable">
  <thead>
    <tr>
      <th>Stock</th>
      <th>Qty</th>
      <th>Avg Buy</th>
      <th>Avg Short</th>
      <th>Current Value</th>
      <th>P/L</th>
    </tr>
  </thead>
  <tbody id="tradeRows"></tbody>
</table>

<script>
/* ----------------------------  STOCKS -------------------------- */
const stocks = ['X','Y','Z'];
let funds = 10000;

const portfolio = {};
const stockData = {};

stocks.forEach(s => {
  stockData[s] = Array.from({length:60},()=>100+Math.random()*20);
  portfolio[s] = {
    longQty: 0,
    longAvg: 0,
    shortQty: 0,
    shortAvg: 0
  };
});

/* ----------------------------  PRICE SIM -------------------------- */
function simulatePrice(oldPrice) {
  return Math.max(50, oldPrice + (Math.random()-0.5)*2);
}

function drawChart(ctx, values){
  const w = ctx.canvas.width;
  const h = ctx.canvas.height;
  ctx.clearRect(0,0,w,h);
  const max=Math.max(...values), min=Math.min(...values);
  ctx.beginPath();
  ctx.strokeStyle="#2962ff";
  values.forEach((v,i)=>{
    const x=(i/values.length)*w;
    const y=h - ((v-min)/(max-min))*h;
    if(i===0) ctx.moveTo(x,y);
    else ctx.lineTo(x,y);
  });
  ctx.stroke();
}

/* ----------------------------  RENDER -------------------------- */
function render() {
  const container = document.getElementById("stocks");
  stocks.forEach(symbol=>{
    const div=document.createElement("div");
    div.className="stock-card";
    div.id="card-"+symbol;
    div.innerHTML=`
      <h3>Stock ${symbol}</h3>
      <canvas id="chart-${symbol}" width="260" height="120"></canvas>
      <div class="controls">
        <button class="buy" onclick="buyLong('${symbol}')">Buy</button>
        <button class="sell" onclick="sellLong('${symbol}')">Sell</button>
        <button class="short" onclick="shortSell('${symbol}')">Short Sell</button>
        <button class="cover" onclick="coverShort('${symbol}')">Cover</button>
      </div>
    `;
    container.appendChild(div);
  });
}
render();

/* ----------------------------  TRADING LOGIC -------------------------- */
function buyLong(symbol){
  const price = latestPrice(symbol);
  if(funds >= price){
    let p = portfolio[symbol];
    p.longAvg = (p.longAvg*p.longQty + price) / (p.longQty+1);
    p.longQty++;
    funds -= price;
  }
}

function sellLong(symbol){
  let p = portfolio[symbol];
  if(p.longQty > 0){
    const price = latestPrice(symbol);
    funds += price * p.longQty;
    p.longQty = 0;
    p.longAvg = 0;
  }
}

/* SHORT SELL */
function shortSell(symbol){
  const price = latestPrice(symbol);
  // Short 1 share
  let p = portfolio[symbol];
  p.shortAvg = (p.shortAvg*p.shortQty + price) / (p.shortQty+1);
  p.shortQty++;
  // Selling without owning â†’ receive cash
  funds += price;
}

/* BUY TO COVER */
function coverShort(symbol){
  let p = portfolio[symbol];
  if(p.shortQty > 0){
    const price = latestPrice(symbol);
    // Need to pay to return borrowed shares
    funds -= price * p.shortQty;
    p.shortQty = 0;
    p.shortAvg = 0;
  }
}

/* ----------------------------  CALCULATIONS -------------------------- */
function latestPrice(symbol){
  const arr = stockData[symbol];
  return arr[arr.length-1];
}

function updateDashboard(){
  let holdingsValue = 0;
  let investedLong = 0;
  let shortGain = 0;

  stocks.forEach(symbol=>{
    const p = portfolio[symbol];
    const price = latestPrice(symbol);

    holdingsValue += p.longQty * price;
    investedLong += p.longQty * p.longAvg;

    // unrealized short profit = (avgShort - current) * qty
    shortGain += (p.shortAvg - price) * p.shortQty;
  });

  const pl = (holdingsValue - investedLong) + shortGain;
  const netValue = funds + holdingsValue + shortGain;

  document.getElementById("funds").textContent = funds.toFixed(2);
  document.getElementById("holdings").textContent = holdingsValue.toFixed(2);
  document.getElementById("netValue").textContent = netValue.toFixed(2);
  document.getElementById("pl").textContent = pl.toFixed(2);
  document.getElementById("pl").className = pl>=0 ? "green" : "red";

  updateTradeTable();
}

/* ------------------------- TRADE TABLE ---------------------------- */
function updateTradeTable(){
  const tbody = document.getElementById("tradeRows");
  tbody.innerHTML = "";

  stocks.forEach(symbol=>{
    const p = portfolio[symbol];
    const price = latestPrice(symbol);

    const longValue = p.longQty * price;
    const shortValue = (p.shortAvg - price) * p.shortQty;

    const pl = (longValue - (p.longQty*p.longAvg)) + shortValue;

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${symbol}</td>
      <td>${p.longQty - p.shortQty}</td>
      <td>${p.longAvg.toFixed(2)}</td>
      <td>${p.shortAvg.toFixed(2)}</td>
      <td>â‚¹${longValue.toFixed(2)}</td>
      <td class="${pl>=0?'green':'red'}">${pl.toFixed(2)}</td>
    `;
    tbody.appendChild(tr);
  });
}

/* ----------------------------  UPDATE LOOP -------------------------- */
function update(){
  stocks.forEach(symbol=>{
    const arr = stockData[symbol];
    arr.push(simulatePrice(arr[arr.length-1]));
    if(arr.length>120) arr.shift();

    const ctx = document.getElementById("chart-"+symbol).getContext("2d");
    drawChart(ctx, arr);
  });
  updateDashboard();
}

setInterval(update,1000);
</script>
</body>
</html>
