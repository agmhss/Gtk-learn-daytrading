<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Day-Trading Simulator</title>

<style>
body { font-family: Arial; background:#eef2f7; padding:20px; margin:0; }
h1 { text-align:center; }

.dashboard {
  display:flex; justify-content:space-around; flex-wrap:wrap;
  padding:15px; background:white;
  border-radius:10px; margin-bottom:20px;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
}
.metric { font-size:1.2em; font-weight:bold; margin:6px; }

.stock-container {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:15px;
}
.stock-card {
  background:white; padding:15px; border-radius:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.15);
}
canvas { width:100%; height:120px; }

.controls {
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  margin-top:8px;
}
.controls button {
  flex:1;
  padding:6px 10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  color:white;
  font-size:0.9em;
}
.buy { background:#4caf50; }
.sell { background:#f44336; }
.short { background:#3333cc; }
.cover { background:#cc33aa; }
.hold { background:#777; }

#tradeTable {
  width:100%; border-collapse:collapse; margin-top:25px;
  background:white; border-radius:10px;
  overflow:hidden; box-shadow:0 2px 6px rgba(0,0,0,0.15);
}
#tradeTable th, #tradeTable td {
  padding:10px; text-align:center; border-bottom:1px solid #ddd;
}
#tradeTable th { background:#3f51b5; color:white; }
.green { color:#4caf50; font-weight:bold; }
.red { color:#f44336; font-weight:bold; }
</style>
</head>

<body>

<h1>ðŸ“ˆ Advanced Day-Trading Simulator</h1>

<!-- Dashboard -->
<div class="dashboard">
  <div class="metric">ðŸ’° Funds: â‚¹<span id="funds">10000</span></div>
  <div class="metric">ðŸ“¦ Net Holdings: â‚¹<span id="holdings">0</span></div>
  <div class="metric">ðŸ’¹ Net Value: â‚¹<span id="netValue">10000</span></div>
  <div class="metric">ðŸ“Š P/L: <span id="pl">0</span></div>
</div>

<!-- Stocks area -->
<div class="stock-container" id="stocks"></div>

<!-- Dashboard Table -->
<h2>ðŸ“˜ Trade Dashboard</h2>
<table id="tradeTable">
  <thead>
    <tr>
      <th>Stock</th>
      <th>Qty</th>
      <th>Avg Buy</th>
      <th>Avg Short</th>
      <th>Current Value</th>
      <th>P/L</th>
    </tr>
  </thead>
  <tbody id="tradeRows"></tbody>
</table>

<script>
/* ------------------ STOCKS ------------------- */
const stocks = ['X','Y','Z'];
let funds = 10000;

const stockData = {};
const portfolio = {};

stocks.forEach(s => {
  stockData[s] = Array.from({length:60},()=>100+Math.random()*20);
  portfolio[s] = {
    longQty: 0,
    longAvg: 0,
    shortQty: 0,
    shortAvg: 0,
    longSL: null,
    shortSL: null
  };
});

/* ----------- PRICE SIMULATION + CHART ----------- */
function simulatePrice(oldPrice){
  return Math.max(50, oldPrice + (Math.random()-0.5)*2);
}

function drawChart(ctx, values){
  const w = ctx.canvas.width, h = ctx.canvas.height;
  ctx.clearRect(0,0,w,h);
  const max = Math.max(...values), min = Math.min(...values);

  ctx.beginPath(); ctx.strokeStyle="#2962ff";
  values.forEach((v,i)=>{
    const x=(i/values.length)*w;
    const y=h - ((v-min)/(max-min))*h;
    if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  });
  ctx.stroke();
}

function render(){
  const container = document.getElementById("stocks");

  stocks.forEach(symbol=>{
    const div=document.createElement("div");
    div.className="stock-card";
    div.id="card-"+symbol;

    div.innerHTML=`
      <h3>Stock ${symbol}</h3>
      <canvas id="chart-${symbol}" width="260" height="120"></canvas>

      <div class="controls">
        <button class="buy" onclick="buyLong('${symbol}')">Buy</button>
        <button class="sell" onclick="sellLong('${symbol}')">Sell</button>
        <button class="short" onclick="shortSell('${symbol}')">Short Sell</button>
        <button class="cover" onclick="coverShort('${symbol}')">Cover</button>
      </div>

      <div class="controls">
        <button class="hold" onclick="setLongSL('${symbol}')">Set Long SL</button>
        <button class="hold" onclick="setShortSL('${symbol}')">Set Short SL</button>
      </div>
    `;

    container.appendChild(div);
  });
}
render();

/* ------------------ GET PRICE ------------------ */
function latestPrice(symbol){
  const arr = stockData[symbol];
  return arr[arr.length-1];
}

/* ------------------ LONG TRADING ------------------ */
function buyLong(symbol){
  const price = latestPrice(symbol);
  if(funds >= price){
    let p = portfolio[symbol];
    p.longAvg = (p.longAvg*p.longQty + price) / (p.longQty+1);
    p.longQty++;
    funds -= price;
  }
}

function sellLong(symbol){
  let p = portfolio[symbol];
  if(p.longQty > 0){
    const price = latestPrice(symbol);
    funds += price * p.longQty;
    p.longQty = 0;
    p.longAvg = 0;
    p.longSL = null;
  }
}

/* ------------------ SHORT TRADING ------------------ */
function shortSell(symbol){
  const price = latestPrice(symbol);
  let p = portfolio[symbol];
  p.shortAvg = (p.shortAvg*p.shortQty + price) / (p.shortQty+1);
  p.shortQty++;
  funds += price;
}

function coverShort(symbol){
  let p = portfolio[symbol];
  if(p.shortQty > 0){
    const price = latestPrice(symbol);
    funds -= price * p.shortQty;
    p.shortQty = 0;
    p.shortAvg = 0;
    p.shortSL = null;
  }
}

/* ------------------ STOP LOSS ------------------ */
function setLongSL(symbol){
  const price = latestPrice(symbol);
  const inp = prompt(`Set LONG Stop-Loss for ${symbol} (Current â‚¹${price.toFixed(2)})`);
  const sl = parseFloat(inp);
  if(!isNaN(sl)){
    portfolio[symbol].longSL = sl;
    alert(`Long SL set at â‚¹${sl}`);
  }
}

function setShortSL(symbol){
  const price = latestPrice(symbol);
  const inp = prompt(`Set SHORT Stop-Loss for ${symbol} (Current â‚¹${price.toFixed(2)})`);
  const sl = parseFloat(inp);
  if(!isNaN(sl)){
    portfolio[symbol].shortSL = sl;
    alert(`Short SL set at â‚¹${sl}`);
  }
}

/* ------------------ DASHBOARD ------------------ */
function updateTradeTable(){
  const tbody = document.getElementById("tradeRows");
  tbody.innerHTML="";

  stocks.forEach(symbol=>{
    const p = portfolio[symbol];
    const price = latestPrice(symbol);

    const longVal = p.longQty * price;
    const shortVal = (p.shortAvg - price) * p.shortQty;

    const pl = (longVal - p.longQty*p.longAvg) + shortVal;

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${symbol}</td>
      <td>${p.longQty - p.shortQty}</td>
      <td>${p.longAvg.toFixed(2)}</td>
      <td>${p.shortAvg.toFixed(2)}</td>
      <td>â‚¹${longVal.toFixed(2)}</td>
      <td class="${pl>=0?'green':'red'}">${pl.toFixed(2)}</td>
    `;
    tbody.appendChild(row);
  });
}

function updateMainDashboard(){
  let holdingsValue = 0;
  let longInvested = 0;
  let shortGain = 0;

  stocks.forEach(symbol=>{
    const p = portfolio[symbol];
    const price = latestPrice(symbol);

    holdingsValue += p.longQty * price;
    longInvested += p.longQty * p.longAvg;
    shortGain += (p.shortAvg - price) * p.shortQty;
  });

  const pl = (holdingsValue - longInvested) + shortGain;
  const netValue = funds + holdingsValue + shortGain;

  document.getElementById("funds").textContent = funds.toFixed(2);
  document.getElementById("holdings").textContent = holdingsValue.toFixed(2);
  document.getElementById("netValue").textContent = netValue.toFixed(2);

  const plElem = document.getElementById("pl");
  plElem.textContent = pl.toFixed(2);
  plElem.className = pl>=0 ? "green" : "red";
}

/* ------------------ UPDATER LOOP ------------------ */
function update(){
  stocks.forEach(symbol=>{
    const arr = stockData[symbol];
    arr.push(simulatePrice(arr[arr.length-1]));
    if(arr.length>120) arr.shift();

    const ctx = document.getElementById("chart-"+symbol).getContext("2d");
    drawChart(ctx, arr);

    const currentPrice = latestPrice(symbol);
    const p = portfolio[symbol];

    /* ---- LONG STOP LOSS ---- */
    if(p.longQty>0 && p.longSL!==null){
      if(currentPrice <= p.longSL){
        alert(`${symbol} LONG Stop-Loss hit at â‚¹${currentPrice.toFixed(2)}`);
        funds += p.longQty * currentPrice;
        p.longQty = 0;
        p.longAvg = 0;
        p.longSL = null;
      }
    }

    /* ---- SHORT STOP LOSS ---- */
    if(p.shortQty>0 && p.shortSL!==null){
      if(currentPrice >= p.shortSL){
        alert(`${symbol} SHORT Stop-Loss hit at â‚¹${currentPrice.toFixed(2)}`);
        funds -= p.shortQty * currentPrice;
        p.shortQty = 0;
        p.shortAvg = 0;
        p.shortSL = null;
      }
    }
  });

  updateMainDashboard();
  updateTradeTable();
}

setInterval(update, 1000);
</script>

</body>
</html>
